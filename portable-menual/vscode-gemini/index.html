<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linux Mint Portable VS Code 구축 매뉴얼</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <h1>Linux Mint Portable VS Code (v1.85) 구축 매뉴얼</h1>
    <p>
        본 매뉴얼은 <strong>Guest 계정, Root 권한 없음, 구형 라이브러리(glibc)</strong> 환경에서 
        VS Code를 설치 없이(Portable) 사용하고, 터미널 오류를 해결하며, URL Scheme(vscode://)을 연동하는 방법을 기술합니다.
    </p>

    <div class="step">
        <h2>1. VS Code 1.85 버전 다운로드 및 압축 해제</h2>
        
        <h3>작업 내용</h3>
        <p>최신 버전(1.86+)이 아닌 1.85.2 버전의 <code>.tar.gz</code> 파일을 다운로드하여 홈 디렉토리에 압축을 풉니다.</p>

        <div class="command-box">
            # 1. 홈 디렉토리로 이동<br>
            cd ~<br><br>
            # 2. 다운로드 (1.85.2 버전)<br>
            wget https://update.code.visualstudio.com/1.85.2/linux-x64/stable -O vscode-1.85.tar.gz<br><br>
            # 3. 압축 해제<br>
            tar -xvzf vscode-1.85.tar.gz<br><br>
            # 4. 폴더명 변경 (선택사항)<br>
            mv VSCode-linux-x64 VSCode
        </div>

        <div class="explanation">
            <strong>왜 이 작업을 하는가?</strong>
            <ul>
                <li><strong>버전 선택(1.85):</strong> 최신 VS Code(1.86 이상)는 <code>glibc 2.28</code> 이상을 요구합니다. 현재 시스템의 라이브러리 버전이 낮아 최신 버전을 실행하면 터미널이 작동하지 않으므로, 호환되는 마지막 버전인 1.85를 사용합니다.</li>
                <li><strong>홈 디렉토리 사용:</strong> <code>/tmp</code> 폴더는 보안상 실행 권한(noexec)이 없거나 제약이 심해 터미널 프로세스가 차단됩니다. 반드시 <code>~</code>(홈)에서 실행해야 합니다.</li>
            </ul>
        </div>
    </div>

    <div class="step">
        <h2>2. Portable 모드 활성화</h2>
        
        <h3>작업 내용</h3>
        <p>압축을 푼 폴더 내부에 <code>data</code> 폴더를 생성합니다.</p>

        <div class="command-box">
            cd ~/VSCode<br>
            mkdir data
        </div>

        <div class="explanation">
            <strong>왜 이 작업을 하는가?</strong><br>
            VS Code는 실행 파일 옆에 <code>data</code>라는 이름의 폴더가 있으면, 
            모든 설정(User Settings)과 확장 프로그램(Extensions)을 시스템 경로(<code>~/.config</code>)가 아닌 
            <strong>이 폴더 안에 저장</strong>합니다. 이를 통해 폴더만 옮기면 어디서든 똑같은 환경을 쓸 수 있는 Portable 모드가 됩니다.
        </div>
    </div>

    <div class="step">
        <h2>3. .desktop 파일 생성 (실행 아이콘 및 URL 연동)</h2>
        
        <h3>작업 내용</h3>
        <p>시스템 메뉴 등록과 <code>vscode://</code> 링크 처리를 위한 바로가기 파일을 생성합니다.</p>
        <p><strong>파일 경로:</strong> <code>~/.local/share/applications/vscode-portable.desktop</code></p>

        <div class="file-content">
[Desktop Entry]
Name=VS Code Portable
Comment=Code Editing. Redefined.
GenericName=Text Editor
# [중요] --no-sandbox 옵션 필수, %F는 파일 인자 전달
Exec=/home/사용자명/VSCode/code --no-sandbox %F
Icon=/home/사용자명/VSCode/resources/app/resources/linux/code.png
Type=Application
StartupNotify=false
StartupWMClass=Code
Categories=TextEditor;Development;IDE;
# [중요] vscode:// 프로토콜 핸들러 등록
MimeType=text/plain;inode/directory;application/x-code-workspace;x-scheme-handler/vscode;
        </div>

        <div class="explanation">
            <strong>핵심 설정 분석:</strong>
            <ul>
                <li><code>Exec=... --no-sandbox</code>: Root 권한이 없어 <code>chrome-sandbox</code> 파일의 권한(4755)을 수정할 수 없습니다. 따라서 샌드박스 기능을 끄는 옵션을 실행 명령어에 강제로 포함해야 합니다.</li>
                <li><code>MimeType=...x-scheme-handler/vscode;</code>: 운영체제에게 "vscode:// 로 시작하는 링크는 이 프로그램이 처리한다"라고 알려주는 설정입니다.</li>
            </ul>
        </div>
    </div>

    <div class="step">
        <h2>4. URL Scheme 핸들러 시스템 등록</h2>
        
        <h3>작업 내용</h3>
        <p>작성한 <code>.desktop</code> 파일을 시스템에 반영하여 기본 처리기로 설정합니다.</p>

        <div class="command-box">
            # 1. 데스크톱 데이터베이스 갱신<br>
            update-desktop-database ~/.local/share/applications<br><br>
            # 2. vscode:// 링크의 기본 프로그램을 이것으로 지정<br>
            xdg-mime default vscode-portable.desktop x-scheme-handler/vscode
        </div>

        <div class="explanation">
            <strong>왜 이 작업을 하는가?</strong><br>
            <code>.desktop</code> 파일에 <code>MimeType</code>을 적었다고 바로 적용되지 않습니다. 
            <code>xdg-mime</code> 명령어를 통해 리눅스 시스템의 연결 프로그램 레지스트리에 명시적으로 등록해야 웹 브라우저 등에서 <code>vscode://</code> 링크를 클릭했을 때 포터블 버전이 실행됩니다.
        </div>
    </div>

    <div class="step">
        <h2>5. 마무리 설정 (업데이트 끄기)</h2>
        
        <h3>작업 내용</h3>
        <p>VS Code 실행 후 자동 업데이트를 비활성화합니다.</p>
        
        <div class="file-content">
[settings.json 파일 설정]
"update.mode": "none"
        </div>

        <div class="explanation">
            <strong>왜 이 작업을 하는가?</strong><br>
            현재 시스템 호환성 문제로 1.85 버전을 고정해서 사용 중입니다. 
            자동 업데이트가 켜져 있으면 호환되지 않는 최신 버전으로 덮어씌워져 다시 터미널 오류가 발생할 수 있습니다. 
            또한 <strong>GPU 설정</strong>은 1.85 버전에서는 별도로 끌 필요가 없었습니다(성공 확인).
        </div>
    </div>

</div>

</body>
</html>